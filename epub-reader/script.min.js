"use strict";function isRavenDisabled(){try{return!("undefined"==typeof disableRaven||!disableRaven)||!(void 0===window.disableRaven||!window.disableRaven)}catch(t){return!1}}window.onerror=function(t,e,i,o,n){if(!(t.indexOf("Permission denied")>-1||t.indexOf("Object expected")>-1&&e.indexOf("epub")>-1)){document.querySelector(".app .error").classList.remove("hidden"),document.querySelector(".app .error .error-title").innerHTML="Error",document.querySelector(".app .error .error-description").innerHTML='Please try reloading the page or using a different browser (Chrome or Firefox), and if the error still persists, <a href="https://github.com/pgaskin/ePubViewer/issues">report an issue</a>.',document.querySelector(".app .error .error-info").innerHTML=t,document.querySelector(".app .error .error-dump").innerHTML=JSON.stringify({error:n.toString(),stack:n.stack,msg:t,url:e,line:i,column:o});try{isRavenDisabled()||Raven.captureException(n)}catch(n){}}};let App=function(t){this.ael=t,this.state={},this.doReset(),document.body.addEventListener("keyup",this.onKeyUp.bind(this)),this.qsa(".tab-list .item").forEach(t=>t.addEventListener("click",this.onTabClick.bind(this,t.dataset.tab))),this.qs(".sidebar .search-bar .search-box").addEventListener("keydown",t=>{13==t.keyCode&&this.qs(".sidebar .search-bar .search-button").click()}),this.qs(".sidebar .search-bar .search-button").addEventListener("click",this.onSearchClick.bind(this)),this.qs(".sidebar-wrapper").addEventListener("click",t=>{try{t.target.classList.contains("sidebar-wrapper")&&t.target.classList.add("out")}catch(t){this.fatal("error hiding sidebar",t)}}),this.qsa(".chips[data-chips]").forEach(t=>{Array.from(t.querySelectorAll(".chip[data-value]")).forEach(e=>e.addEventListener("click",i=>{this.setChipActive(t.dataset.chips,e.dataset.value)}))}),this.qs("button.prev").addEventListener("click",()=>this.state.rendition.prev()),this.qs("button.next").addEventListener("click",()=>this.state.rendition.next()),this.qs("button.open").addEventListener("click",()=>this.doOpenBook());try{this.qs(".bar .loc").style.cursor="pointer",this.qs(".bar .loc").addEventListener("click",t=>{try{let t=prompt(`Location to go to (up to ${this.state.book.locations.length()})?`,this.state.rendition.currentLocation().start.location);if(!t)return;if(""==(t=t.trim()))return;let e=parseInt(t,10);if(isNaN(e)||e<0)throw new Error("Invalid location: not a positive integer");if(e>this.state.book.locations.length())throw new Error("Invalid location");let i=this.state.book.locations.cfiFromLocation(e);if(-1===i)throw new Error("Invalid location");this.state.rendition.display(i)}catch(t){alert(t.toString())}})}catch(t){throw this.fatal("error attaching event handlers for location go to",t),t}this.doTab("toc");try{this.loadSettingsFromStorage()}catch(t){throw this.fatal("error loading settings",t),t}this.applyTheme()};App.prototype.doBook=function(t,e){this.qs(".book").innerHTML="Loading",e=e||{encoding:"epub"},console.log("doBook",t,e),this.doReset();try{this.state.book=ePub(t,e),this.qs(".book").innerHTML="",this.state.rendition=this.state.book.renderTo(this.qs(".book"),{})}catch(t){throw this.fatal("error loading book",t),t}this.state.book.ready.then(this.onBookReady.bind(this)).catch(this.fatal.bind(this,"error loading book")),this.state.book.loaded.navigation.then(this.onNavigationLoaded.bind(this)).catch(this.fatal.bind(this,"error loading toc")),this.state.book.loaded.metadata.then(this.onBookMetadataLoaded.bind(this)).catch(this.fatal.bind(this,"error loading metadata")),this.state.book.loaded.cover.then(this.onBookCoverLoaded.bind(this)).catch(this.fatal.bind(this,"error loading cover")),this.state.rendition.hooks.content.register(this.applyTheme.bind(this)),this.state.rendition.hooks.content.register(this.loadFonts.bind(this)),this.state.rendition.on("relocated",this.onRenditionRelocated.bind(this)),this.state.rendition.on("click",this.onRenditionClick.bind(this)),this.state.rendition.on("keyup",this.onKeyUp.bind(this)),this.state.rendition.on("displayed",this.onRenditionDisplayedTouchSwipe.bind(this)),this.state.rendition.on("relocated",this.onRenditionRelocatedUpdateIndicators.bind(this)),this.state.rendition.on("relocated",this.onRenditionRelocatedSavePos.bind(this)),this.state.rendition.on("started",this.onRenditionStartedRestorePos.bind(this)),this.state.rendition.on("displayError",this.fatal.bind(this,"error rendering book")),this.state.rendition.display(),this.state.dictInterval&&window.clearInterval(this.state.dictInterval),this.state.dictInterval=window.setInterval(this.checkDictionary.bind(this),50),this.doDictionary(null)},App.prototype.loadSettingsFromStorage=function(){["theme","font","font-size","line-spacing","margin","progress"].forEach(t=>this.restoreChipActive(t))},App.prototype.restoreChipActive=function(t){let e=localStorage.getItem(`ePubViewer:${t}`);if(e)return this.setChipActive(t,e);this.setDefaultChipActive(t)},App.prototype.setDefaultChipActive=function(t){let e=this.qs(`.chips[data-chips='${t}']`).querySelector(".chip[data-default]");return this.setChipActive(t,e.dataset.value),e.dataset.value},App.prototype.setChipActive=function(t,e){return Array.from(this.qs(`.chips[data-chips='${t}']`).querySelectorAll(".chip[data-value]")).forEach(t=>{t.classList[t.dataset.value==e?"add":"remove"]("active")}),localStorage.setItem(`ePubViewer:${t}`,e),this.applyTheme(),this.state.rendition&&this.state.rendition.location&&this.onRenditionRelocatedUpdateIndicators(this.state.rendition.location),e},App.prototype.getChipActive=function(t){let e=this.qs(`.chips[data-chips='${t}']`).querySelector(".chip.active[data-value]");return e?e.dataset.value:this.qs(`.chips[data-chips='${t}']`).querySelector(".chip[data-default]")},App.prototype.doOpenBook=function(){var t=document.createElement("input");t.setAttribute("accept","application/epub+zip"),t.style.display="none",t.type="file",t.onchange=(e=>{var i=new FileReader;i.addEventListener("load",()=>{for(var t=new Uint8Array(i.result).subarray(0,2),e="",o=0;o<t.length;o++)e+=t[o].toString(16);"504b"==e?this.doBook(i.result,{encoding:"binary"}):this.fatal("invalid file","not an epub book")},!1),t.files[0]&&i.readAsArrayBuffer(t.files[0])}),document.body.appendChild(t),t.click()},App.prototype.fatal=function(t,e,i){console.error(t,e),document.querySelector(".app .error").classList.remove("hidden"),document.querySelector(".app .error .error-title").innerHTML="Error",document.querySelector(".app .error .error-description").innerHTML=i?"":'Please try reloading the page or using a different browser, and if the error still persists, <a href="https://github.com/pgaskin/ePubViewer/issues">report an issue</a>.',document.querySelector(".app .error .error-info").innerHTML=t+": "+e.toString(),document.querySelector(".app .error .error-dump").innerHTML=JSON.stringify({error:e.toString(),stack:e.stack});try{isRavenDisabled()||i||Raven.captureException(e)}catch(e){}},App.prototype.doReset=function(){this.state.dictInterval&&window.clearInterval(this.state.dictInterval),this.state.rendition&&this.state.rendition.destroy(),this.state.book&&this.state.book.destroy(),this.state={book:null,rendition:null},this.qs(".sidebar-wrapper").classList.add("out"),this.qs(".bar .book-title").innerHTML="",this.qs(".bar .book-author").innerHTML="",this.qs(".bar .loc").innerHTML="",this.qs(".search-results").innerHTML="",this.qs(".search-box").value="",this.qs(".toc-list").innerHTML="",this.qs(".info .cover").src="",this.qs(".info .title").innerHTML="",this.qs(".info .series-info").classList.remove("hidden"),this.qs(".info .series-name").innerHTML="",this.qs(".info .series-index").innerHTML="",this.qs(".info .author").innerHTML="",this.qs(".info .description").innerHTML="",this.qs(".book").innerHTML='<div class="empty-wrapper"><div class="empty"><div class="app-name ">ePUB Reader</div><div class="message"><p>Read ePUB eBooks online</p><a href="javascript:ePubViewer.doOpenBook();" class="big-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-cloud-upload-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 4.095 0 5.555 0 7.318 0 9.366 1.708 11 3.781 11H7.5V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11h4.188C14.502 11 16 9.57 16 7.773c0-1.636-1.242-2.969-2.834-3.194C12.923 1.999 10.69 0 8 0zm-.5 14.5V11h1v3.5a.5.5 0 0 1-1 0z" /></svg> Open a Book</a></div></div>  </div>',this.qs(".sidebar-button").classList.add("hidden"),this.qs(".bar button.prev").classList.add("hidden"),this.qs(".bar button.next").classList.add("hidden"),this.doDictionary(null)},App.prototype.qs=function(t){return this.ael.querySelector(t)},App.prototype.qsa=function(t){return Array.from(this.ael.querySelectorAll(t))},App.prototype.el=function(t,e){let i=document.createElement(t);return e&&i.classList.add(e),i},App.prototype.onBookReady=function(t){this.qs(".book-ads").classList.add("hidden"),this.qs(".book-outer").classList.add("book-ready"),this.qs(".sidebar-button").classList.remove("hidden"),this.qs(".bar button.prev").classList.remove("hidden"),this.qs(".bar button.next").classList.remove("hidden"),console.log("bookKey",this.state.book.key());let e=`${this.state.book.key()}:locations-1650`,i=localStorage.getItem(e);return console.log("storedLocations","string"==typeof i?i.substr(0,40)+"...":i),i?this.state.book.locations.load(i):(console.log("generating locations"),this.state.book.locations.generate(1650).then(()=>{localStorage.setItem(e,this.state.book.locations.save()),console.log("locations generated",this.state.book.locations)}).catch(t=>console.error("error generating locations",t)))},App.prototype.onTocItemClick=function(t,e){console.log("tocClick",t),this.state.rendition.display(t).catch(t=>console.warn("error displaying page",t)),e.stopPropagation(),e.preventDefault()},App.prototype.getNavItem=function(t,e){return function t(e){return[].concat(...e.map(e=>[e,...t(e.subitems)]))}(this.state.book.navigation.toc).filter(i=>e?this.state.book.canonical(i.href).split("#")[0]==this.state.book.canonical(t.start.href).split("#")[0]:this.state.book.canonical(i.href)==this.state.book.canonical(t.start.href))[0]||null},App.prototype.onNavigationLoaded=function(t){console.log("navigation",t);let e=this.qs(".toc-list");e.innerHTML="";let i=(t,o)=>{t.forEach(t=>{let n=e.appendChild(this.el("a","item"));n.href=t.href,n.dataset.href=t.href,n.innerHTML=`${"&nbsp;".repeat(4*o)}${t.label.trim()}`,n.addEventListener("click",this.onTocItemClick.bind(this,t.href)),i(t.subitems,o+1)})};i(t.toc,0)},App.prototype.onRenditionRelocated=function(t){try{this.doDictionary(null)}catch(t){}try{let e=this.getNavItem(t,!1)||this.getNavItem(t,!0);this.qsa(".toc-list .item").forEach(t=>t.classList[e&&t.dataset.href==e.href?"add":"remove"]("active"))}catch(t){this.fatal("error updating toc",t)}},App.prototype.onBookMetadataLoaded=function(t){console.log("metadata",t),this.qs(".bar .book-title").innerText=t.title.trim(),this.qs(".bar .book-author").innerText=t.creator.trim(),this.qs(".info .title").innerText=t.title.trim(),this.qs(".info .author").innerText=t.creator.trim(),t.series&&""!=t.series.trim()||this.qs(".info .series-info").classList.add("hidden"),this.qs(".info .series-name").innerText=t.series.trim(),this.qs(".info .series-index").innerText=t.seriesIndex.trim(),this.qs(".info .description").innerText=t.description,sanitizeHtml&&(this.qs(".info .description").innerHTML=sanitizeHtml(t.description))},App.prototype.onBookCoverLoaded=function(t){t&&(this.state.book.archived?this.state.book.archive.createUrl(t).then(t=>{this.qs(".cover").src=t}).catch(console.warn.bind(console)):this.qs(".cover").src=t)},App.prototype.onKeyUp=function(t){let e=t.keyCode||t.which,i=null;37==e?(this.state.rendition.prev(),i=this.qs(".app .bar button.prev")):39==e&&(this.state.rendition.next(),i=this.qs(".app .bar button.next")),i&&(i.style.transform="scale(1.15)",window.setTimeout(()=>i.style.transform="",150))},App.prototype.onRenditionClick=function(t){try{if("a"==t.target.tagName.toLowerCase()&&t.target.href)return;if("a"==t.target.parentNode.tagName.toLowerCase()&&t.target.parentNode.href)return;if(0!==window.getSelection().toString().length)return;if(0!==this.state.rendition.manager.getContents()[0].window.getSelection().toString().length)return}catch(t){}let e=this.state.rendition.manager.container,i=e.clientWidth/3,o=t.pageX-e.scrollLeft,n=null;o>e.clientWidth-20?(t.preventDefault(),this.doSidebar()):o<i?(t.preventDefault(),this.state.rendition.prev(),n=this.qs(".bar button.prev")):o>2*i&&(t.preventDefault(),this.state.rendition.next(),n=this.qs(".bar button.next")),n&&(n.style.transform="scale(1.15)",window.setTimeout(()=>n.style.transform="",150))},App.prototype.onRenditionDisplayedTouchSwipe=function(t){let e=null,i=null;const o=t.document.documentElement;o.addEventListener("touchstart",t=>{e=t.changedTouches[0]}),o.addEventListener("touchend",t=>{let n=((i=t.changedTouches[0]).screenX-e.screenX)/o.getBoundingClientRect().width,r=(i.screenY-e.screenY)/o.getBoundingClientRect().height;return n>r&&n>.25?this.state.rendition.prev():n<r&&n<-.25?this.state.rendition.next():void 0})},App.prototype.applyTheme=function(){let t={bg:this.getChipActive("theme").split(";")[0],fg:this.getChipActive("theme").split(";")[1],l:"#1e83d2",ff:this.getChipActive("font"),fs:this.getChipActive("font-size"),lh:this.getChipActive("line-spacing"),ta:"justify",m:this.getChipActive("margin")},e={body:{background:t.bg,color:t.fg,"font-family":""!=t.ff?`${t.ff} !important`:"!invalid-hack","font-size":""!=t.fs?`${t.fs} !important`:"!invalid-hack","line-height":`${t.lh} !important`,"text-align":`${t.ta} !important`,"padding-top":t.m,"padding-bottom":t.m},p:{"font-family":""!=t.ff?`${t.ff} !important`:"!invalid-hack","font-size":""!=t.fs?`${t.fs} !important`:"!invalid-hack"},a:{color:"inherit !important","text-decoration":"none !important","-webkit-text-fill-color":"inherit !important"},"a:link":{color:`${t.l} !important`,"text-decoration":"none !important","-webkit-text-fill-color":`${t.l} !important`},"a:link:hover":{background:"rgba(0, 0, 0, 0.1) !important"},img:{"max-width":"100% !important"}};try{this.ael.style.background=t.bg,this.ael.style.fontFamily=t.ff,this.ael.style.color=t.fg,this.state.rendition&&this.state.rendition.getContents().forEach(t=>t.addStylesheetRules(e))}catch(t){console.error("error applying theme",t)}},App.prototype.loadFonts=function(){this.state.rendition.getContents().forEach(t=>{["https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap","https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i&display=swap"].forEach(e=>{let i=t.document.body.appendChild(t.document.createElement("link"));i.setAttribute("rel","stylesheet"),i.setAttribute("href",e)})})},App.prototype.onRenditionRelocatedUpdateIndicators=function(t){try{if("bar"==this.getChipActive("progress")){this.qs(".bar .loc").innerHTML="";let e=this.qs(".bar .loc").appendChild(document.createElement("div"));e.style.position="relative",e.style.width="60vw",e.style.cursor="default",e.addEventListener("click",t=>t.stopImmediatePropagation(),!1);let i=e.appendChild(document.createElement("input"));i.type="range",i.style.width="100%",i.min=0,i.max=this.state.book.locations.length(),i.value=t.start.location,i.addEventListener("change",()=>this.state.rendition.display(this.state.book.locations.cfiFromLocation(i.value)),!1);let o=e.appendChild(document.createElement("div"));o.style.position="absolute",o.style.width="100%",o.style.height="50%",o.style.bottom="0",o.style.left="0",o.style.right="0";for(let t=0,e=-1;t<this.state.book.locations.length();t++)try{let i=(new ePub.CFI).parse(this.state.book.locations.cfiFromLocation(t));if(i.spinePos<0||i.spinePos==e)continue;e=i.spinePos;let n=o.appendChild(document.createElement("div"));n.style.position="absolute",n.style.left=`${100*this.state.book.locations.percentageFromLocation(t)}%`,n.style.width="4px",n.style.height="30%",n.style.cursor="pointer",n.style.opacity="0.5",n.addEventListener("click",this.onTocItemClick.bind(this,this.state.book.locations.cfiFromLocation(t)),!1);let r=n.appendChild(document.createElement("div"));r.style.width="1px",r.style.height="100%",r.style.backgroundColor="currentColor"}catch(e){console.warn("Error adding marker for location",t,e)}return}let e="Loading";if("none"==this.getChipActive("progress"))e="";else if("location"==this.getChipActive("progress")&&t.start.location>0)e=`Loc ${t.start.location}/${this.state.book.locations.length()}`;else if("chapter"==this.getChipActive("progress")){let i=this.getNavItem(t,!1)||this.getNavItem(t,!0);e=i?i.label.trim():t.start.percentage>0&&t.start.percentage<1?`${Math.round(100*t.start.percentage)}%`:""}else e=t.start.percentage>0&&t.start.percentage<1?`${Math.round(1e3*t.start.percentage)/10}%`:"";this.qs(".bar .loc").innerHTML=e}catch(t){console.error("error updating indicators")}},App.prototype.onRenditionRelocatedSavePos=function(t){localStorage.setItem(`${this.state.book.key()}:pos`,t.start.cfi)},App.prototype.onRenditionStartedRestorePos=function(t){try{let t=localStorage.getItem(`${this.state.book.key()}:pos`);console.log("storedPos",t),t&&this.state.rendition.display(t)}catch(t){this.fatal("error restoring position",t)}},App.prototype.checkDictionary=function(){try{let t=this.state.rendition.manager&&this.state.rendition.manager.getContents().length>0?this.state.rendition.manager.getContents()[0].window.getSelection().toString().trim():"";if(t.length<2||t.indexOf(" ")>-1)return this.state.showDictTimeout&&window.clearTimeout(this.state.showDictTimeout),void this.doDictionary(null);this.state.showDictTimeout=window.setTimeout(()=>{try{let e=this.state.rendition.manager.getContents()[0].window.getSelection().toString().trim();e==t&&this.doDictionary(e)}catch(t){console.error(`showDictTimeout: ${t.toString()}`)}},300)}catch(t){console.error(`checkDictionary: ${t.toString()}`)}},App.prototype.doDictionary=function(t){if(this.state.lastWord&&this.state.lastWord==t)return;if(this.state.lastWord=t,this.qs(".dictionary-wrapper").classList.contains("hidden")||console.log("hide dictionary"),this.qs(".dictionary-wrapper").classList.add("hidden"),this.qs(".dictionary").innerHTML="",!t)return;console.log(`define ${t}`),this.qs(".dictionary-wrapper").classList.remove("hidden"),this.qs(".dictionary").innerHTML="";let e=this.qs(".dictionary").appendChild(document.createElement("div"));e.classList.add("definition");let i=e.appendChild(document.createElement("div"));i.classList.add("word"),i.innerText=t;let o=e.appendChild(document.createElement("div"));o.classList.add("meanings"),o.innerHTML="Loading",fetch(`https://dict.geek1011.net/word/${encodeURIComponent(t)}`).then(t=>{if(t.status>=500)throw new Error("Dictionary not available");if(404==t.status)throw new Error("Word not found");return t.json()}).then(t=>{if("error"==t.status)throw new Error(`ApiError: ${t.result}`);return t.result}).then(t=>{console.log("dictLookup",t),e.parentElement.removeChild(e),[t].concat(t.additional_words||[]).concat(t.referenced_words||[]).map(t=>{let e=this.qs(".dictionary").appendChild(document.createElement("div"));e.classList.add("definition");let i=e.appendChild(document.createElement("div"));i.classList.add("word"),i.innerText=[t.word].concat(t.alternates||[]).join(", ").toLowerCase();let o=e.appendChild(document.createElement("div"));if(o.classList.add("meanings"),t.info&&""!=t.info.trim()){let e=o.appendChild(document.createElement("div"));e.classList.add("info"),e.innerText=t.info}if((t.meanings||[]).map((t,e)=>{let i=o.appendChild(document.createElement("div"));i.classList.add("meaning");let n=i.appendChild(document.createElement("div"));if(n.classList.add("text"),n.innerText=`${e+1}. ${t.text}`,t.example&&""!=t.example.trim()){let e=i.appendChild(document.createElement("div"));e.classList.add("example"),e.innerText=t.example}}),(t.notes||[]).map(t=>{let e=o.appendChild(document.createElement("div"));e.classList.add("note"),e.innerText=t}),t.credit&&""!=t.credit.trim()){let e=o.appendChild(document.createElement("div"));e.classList.add("credit"),e.innerText=t.credit}})}).catch(t=>{try{console.error("dictLookup",t),o.innerText=t.toString()}catch(t){}})},App.prototype.doFullscreen=(()=>{document.fullscreenEnabled=document.fullscreenEnabled||document.mozFullScreenEnabled||document.documentElement.webkitRequestFullScreen;document.fullscreenEnabled&&(t=>{t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)})(document.documentElement)}),App.prototype.doSearch=function(t){return Promise.all(this.state.book.spine.spineItems.map(e=>e.load(this.state.book.load.bind(this.state.book)).then(i=>{let o=e.find(t);return e.unload(),Promise.resolve(o)}))).then(t=>Promise.resolve([].concat.apply([],t)))},App.prototype.onResultClick=function(t,e){console.log("tocClick",t),this.state.rendition.display(t),e.stopPropagation(),e.preventDefault()},App.prototype.doTab=function(t){try{this.qsa(".tab-list .item").forEach(e=>e.classList[e.dataset.tab==t?"add":"remove"]("active")),this.qsa(".tab-container .tab").forEach(e=>e.classList[e.dataset.tab!=t?"add":"remove"]("hidden"));try{this.qs(".tab-container").scrollTop=0}catch(t){}}catch(t){this.fatal("error showing tab",t)}},App.prototype.onTabClick=function(t,e){console.log("tabClick",t),this.doTab(t),e.stopPropagation(),e.preventDefault()},App.prototype.onSearchClick=function(t){this.doSearch(this.qs(".sidebar .search-bar .search-box").value.trim()).then(t=>{this.qs(".sidebar .search-results").innerHTML="";let e=document.createDocumentFragment();t.slice(0,200).forEach(t=>{let i=e.appendChild(this.el("a","item"));i.href=t.cfi,i.addEventListener("click",this.onResultClick.bind(this,t.cfi)),i.appendChild(this.el("div","text")).innerText=t.excerpt.trim(),i.appendChild(this.el("div","pbar")).appendChild(this.el("div","pbar-inner")).style.width=(100*this.state.book.locations.percentageFromCfi(t.cfi)).toFixed(3)+"%"}),this.qs(".app .sidebar .search-results").appendChild(e)}).catch(t=>this.fatal("error searching book",t))},App.prototype.doSidebar=function(){this.qs(".sidebar-wrapper").classList.toggle("out")};let ePubViewer=null;try{ePubViewer=new App(document.querySelector(".app"));let t=location.search.replace("?","")||location.hash.replace("#","");t.startsWith("!")&&(t=t.replace("!",""),document.querySelector(".app button.open").style="display: none !important"),t&&(fetch(t).then(t=>{if(200!=t.status)throw new Error("response status: "+t.status.toString()+" "+t.statusText)}).catch(t=>{ePubViewer.fatal("error loading book",t,!0)}),ePubViewer.doBook(t))}catch(t){document.querySelector(".app .error").classList.remove("hidden"),document.querySelector(".app .error .error-title").innerHTML="Error",document.querySelector(".app .error .error-description").innerHTML='Please try reloading the page or using a different browser (Chrome or Firefox), and if the error still persists, <a href="https://github.com/pgaskin/ePubViewer/issues">report an issue</a>.',document.querySelector(".app .error .error-dump").innerHTML=JSON.stringify({error:t.toString(),stack:t.stack});try{isRavenDisabled||Raven.captureException(t)}catch(t){}}